<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Markdown to DOCX Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f5f7fa; min-height: 100vh; }
        .container { display: flex; flex-direction: column; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #056608 0%, #33A036 50%, #52C755 100%); color: white; padding: 40px 20px; text-align: center; }
        .header h1 { margin: 0 0 10px 0; font-size: 36px; font-weight: 700; }
        .header p { margin: 0; font-size: 16px; opacity: 0.95; }
        .progress-container { width: 100%; height: 4px; background-color: #e0e0e0; position: relative; display: none; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.3s ease; }
        .progress-container.active { display: block; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; max-width: 1600px; margin: 0 auto; width: 100%; flex: 1; }
        .panel { display: flex; flex-direction: column; background: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); overflow: hidden; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #e8eef7; background-color: #fafbfc; }
        .panel-header h2 { margin: 0; font-size: 18px; font-weight: 600; color: #333; }
        .upload-btn { padding: 6px 12px; font-size: 12px; background-color: #f0f0f0; color: #333; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; }
        .upload-btn:hover { background-color: #e0e0e0; }
        textarea { flex: 1; padding: 20px; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.6; border: none; outline: none; resize: none; background-color: #fafbfc; }
        .preview { flex: 1; padding: 20px; overflow: auto; font-size: 15px; line-height: 1.7; }
        .preview h1 { font-size: 26px; margin: 20px 0 12px; font-weight: 700; border-bottom: 2px solid #667eea; padding-bottom: 8px; color: #1a1a1a; }
        .preview h2 { font-size: 20px; margin: 18px 0 10px; font-weight: 600; color: #333; }
        .preview h3 { font-size: 17px; margin: 14px 0 8px; font-weight: 600; color: #555; }
        .preview h4, .preview h5, .preview h6 { margin: 12px 0 6px; font-weight: 600; color: #666; }
        .preview code { background-color: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-size: 13px; color: #c7254e; }
        .preview pre { background-color: #2d2d2d; color: #f8f8f2; padding: 16px; border-radius: 6px; overflow-x: auto; margin: 12px 0; font-size: 12px; line-height: 1.4; }
        .preview pre code { background: none; color: inherit; padding: 0; }
        .preview blockquote { border-left: 4px solid #667eea; padding-left: 16px; margin: 12px 0; color: #666; font-style: italic; }
        .preview table { width: 100%; border-collapse: collapse; margin: 16px 0; border: 1px solid #ddd; }
        .preview th { background-color: #f5f5f5; padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #ddd; }
        .preview td { padding: 10px 12px; border-bottom: 1px solid #eee; }
        .preview ul, .preview ol { margin: 8px 0; padding-left: 24px; }
        .preview a { color: #667eea; text-decoration: none; }
        .preview a:hover { text-decoration: underline; }
        .preview u { text-decoration: underline; }
        .preview s { text-decoration: line-through; }
        .settings-panel { background: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin: 20px; overflow: hidden; }
        .settings-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background-color: #fafbfc; border-bottom: 1px solid #e8eef7; cursor: pointer; }
        .settings-header h3 { margin: 0; font-size: 16px; font-weight: 600; color: #333; }
        .toggle-settings { background: none; border: none; font-size: 20px; cursor: pointer; color: #667eea; }
        .settings-content { padding: 20px; max-height: 600px; overflow-y: auto; }
        .settings-group { margin-bottom: 20px; }
        .settings-group h4 { margin: 15px 0 10px 0; font-size: 14px; font-weight: 600; color: #555; text-transform: uppercase; letter-spacing: 0.5px; }
        .settings-group label { display: flex; align-items: center; padding: 8px 0; font-size: 14px; color: #333; cursor: pointer; }
        .settings-group input[type="checkbox"] { margin-right: 10px; cursor: pointer; width: 16px; height: 16px; }
        .settings-group input[type="text"] { flex: 1; padding: 6px 10px; font-size: 13px; border: 1px solid #ddd; border-radius: 4px; margin-left: 10px; }
        .actions { display: flex; gap: 12px; padding: 20px; justify-content: center; background: white; border-top: 1px solid #e8eef7; flex-wrap: wrap; }
        button { padding: 12px 32px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .convert-btn { background-color: #667eea; color: white; }
        .convert-btn:hover:not(:disabled) { background-color: #5568d3; }
        .convert-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .copy-btn { background-color: #52C755; color: white; }
        .copy-btn:hover:not(:disabled) { background-color: #3FA040; }
        .clear-btn { background-color: white; color: #333; border: 1px solid #ddd; }
        .clear-btn:hover { background-color: #f5f5f5; }
        .message { padding: 12px 20px; margin: 0 20px 20px; border-radius: 6px; text-align: center; }
        .error { background-color: #fee; color: #c00; }
        .success { background-color: #efe; color: #0c0; }
        .footer { background-color: #e8eef7; padding: 30px 20px; border-top: 1px solid #d0d8e8; text-align: center; }
        .footer p { margin: 0 0 8px; font-size: 14px; color: #555; }
        .footer .subtext { font-size: 12px; color: #999; }
        @media (max-width: 1024px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="container">
        <header class="header">
            <h1>üìù Advanced Markdown to DOCX</h1>
            <p>Professional features with custom styling</p>
        </header>

        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <h2>Markdown Editor</h2>
                    <input type="file" id="mdFile" accept=".md,.markdown,.txt" style="display:none">
                    <button class="upload-btn" onclick="document.getElementById('mdFile').click()">üìÇ Load .md</button>
                </div>
                <textarea id="editor" spellcheck="false"># Advanced Demo

## Formatting
**bold** *italic* ~~strikethrough~~ <u>underline</u>

## Links
[Google](https://google.com)

## Lists
1. Item 1
2. Item 2

- Bullet A
- Bullet B

## Code
`inline code`

```js
const x = 42;
```

## Colors
<color:FF0000>Red Text</color>

## Footnotes[^1]
[^1]: This is a footnote
</textarea>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h2>Live Preview</h2>
                </div>
                <div class="preview" id="preview"></div>
            </div>
        </div>

        <div class="settings-panel">
            <div class="settings-header" onclick="toggleSettings()">
                <h3>‚öôÔ∏è Conversion Settings</h3>
                <button class="toggle-settings" id="toggleBtn">‚àí</button>
            </div>
            <div class="settings-content" id="settingsContent">
                <div class="settings-group">
                    <label><input type="checkbox" id="makeHyperlinks" checked> Hyperlinks</label>
                    <label><input type="checkbox" id="strikethrough" checked> Strikethrough</label>
                    <label><input type="checkbox" id="underline" checked> Underline</label>
                    <label><input type="checkbox" id="pageBreaks" checked> Page Breaks</label>
                </div>
                <div class="settings-group">
                    <h4>Professional Features</h4>
                    <label><input type="checkbox" id="smartQuotes"> Smart Quotes</label>
                    <label><input type="checkbox" id="footnotes"> Footnotes</label>
                    <label><input type="checkbox" id="customColors"> Custom Colors</label>
                    <label><input type="checkbox" id="metadata"> Document Metadata</label>
                </div>
                <div class="settings-group">
                    <label><span>Title:</span> <input type="text" id="docTitle" placeholder="Title"></label>
                    <label><span>Author:</span> <input type="text" id="docAuthor" placeholder="Author"></label>
                </div>
            </div>
        </div>

        <div id="message"></div>

        <div class="actions">
            <button class="convert-btn" id="convertBtn">‚¨áÔ∏è Download DOCX</button>
            <button class="copy-btn" id="copyBtn">üìã Copy</button>
            <button class="clear-btn" id="clearBtn">üóëÔ∏è Clear</button>
        </div>

        <footer class="footer">
            <p>üí° Professional markdown conversion with advanced features</p>
            <p class="subtext">Hyperlinks ‚Ä¢ Smart Quotes ‚Ä¢ Footnotes ‚Ä¢ Custom Colors ‚Ä¢ Metadata</p>
        </footer>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const convertBtn = document.getElementById('convertBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        const messageEl = document.getElementById('message');
        const mdFile = document.getElementById('mdFile');
        const progressBar = document.getElementById('progressBar');
        const progressContainer = document.getElementById('progressContainer');

        const settings = {};

        ['makeHyperlinks', 'strikethrough', 'underline', 'pageBreaks', 'smartQuotes', 'footnotes', 'customColors', 'metadata'].forEach(key => {
            const el = document.getElementById(key);
            if (el) {
                settings[key] = el.checked;
                el.addEventListener('change', (e) => {
                    settings[key] = e.target.checked;
                    updatePreview();
                });
            }
        });

        function toggleSettings() {
            const content = document.getElementById('settingsContent');
            const btn = document.getElementById('toggleBtn');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.textContent = '‚àí';
            } else {
                content.style.display = 'none';
                btn.textContent = '+';
            }
        }

        function updatePreview() {
            let html = marked.parse(editor.value);
            if (settings.strikethrough) html = html.replace(/~~(.+?)~~/g, '<s>$1</s>');
            if (settings.underline) html = html.replace(/<u>(.+?)<\/u>/g, '<u>$1</u>');
            if (settings.customColors) html = html.replace(/<color:([A-Fa-f0-9]{6})>(.+?)<\/color>/g, '<span style="color:#$1;">$2</span>');
            preview.innerHTML = html;
        }

        mdFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                editor.value = event.target.result;
                updatePreview();
                showMessage('‚úì File loaded!', 'success');
                mdFile.value = '';
            };
            reader.readAsText(file);
        });

        editor.addEventListener('input', updatePreview);
        updatePreview();

        clearBtn.addEventListener('click', () => {
            if (confirm('Clear all?')) {
                editor.value = '';
                preview.innerHTML = '';
            }
        });

        function showMessage(text, type) {
            messageEl.className = 'message ' + type;
            messageEl.textContent = text;
            setTimeout(() => { messageEl.className = ''; messageEl.textContent = ''; }, 3000);
        }

        copyBtn.addEventListener('click', async () => {
            try {
                const blob = new Blob([preview.innerHTML], { type: 'text/html' });
                const item = new ClipboardItem({ 'text/html': blob, 'text/plain': new Blob([editor.value], { type: 'text/plain' }) });
                await navigator.clipboard.write([item]);
                showMessage('‚úì Copied!', 'success');
            } catch {
                await navigator.clipboard.writeText(editor.value);
                showMessage('‚úì Copied as text!', 'success');
            }
        });

        convertBtn.addEventListener('click', async () => {
            const md = editor.value.trim();
            if (!md) { showMessage('Enter markdown!', 'error'); return; }
            convertBtn.disabled = true;
            convertBtn.textContent = '‚è≥...';
            progressContainer.classList.add('active');
            progressBar.style.width = '25%';
            try {
                progressBar.style.width = '50%';
                const docx = await markdownToDocx(md);
                progressBar.style.width = '100%';
                saveAs(docx, 'document.docx');
                showMessage('‚úì Downloaded!', 'success');
                setTimeout(() => { progressContainer.classList.remove('active'); }, 500);
            } catch (err) {
                showMessage('Error: ' + err.message, 'error');
                progressContainer.classList.remove('active');
            } finally {
                convertBtn.disabled = false;
                convertBtn.textContent = '‚¨áÔ∏è Download DOCX';
            }
        });

        async function markdownToDocx(markdown) {
            const zip = new JSZip();
            zip.file('[Content_Types].xml', getContentTypes());
            zip.file('_rels/.rels', getRels());
            zip.file('word/_rels/document.xml.rels', getDocRels());
            zip.file('word/styles.xml', getStyles());
            zip.file('word/numbering.xml', getNumbering());
            zip.file('word/document.xml', getWordDoc(markdown));
            return await zip.generateAsync({ type: 'blob' });
        }

        function escapeXml(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&apos;');
        }

        function parseFormatting(text) {
            let result = [];
            let i = 0;
            while (i < text.length) {
                if (settings.strikethrough && text.substring(i, i + 2) === '~~') {
                    const end = text.indexOf('~~', i + 2);
                    if (end !== -1) { result.push({ type: 'strike', text: text.substring(i + 2, end) }); i = end + 2; continue; }
                }
                if (text.substring(i, i + 2) === '**') {
                    const end = text.indexOf('**', i + 2);
                    if (end !== -1) { result.push({ type: 'bold', text: text.substring(i + 2, end) }); i = end + 2; continue; }
                }
                if (text[i] === '*' && text[i + 1] !== '*') {
                    const end = text.indexOf('*', i + 1);
                    if (end !== -1 && text[end + 1] !== '*') { result.push({ type: 'italic', text: text.substring(i + 1, end) }); i = end + 1; continue; }
                }
                if (settings.underline && text[i] === '<' && text.substring(i, i + 2) === '<u') {
                    const end = text.indexOf('</u>', i);
                    if (end !== -1) { result.push({ type: 'underline', text: text.substring(i + 3, end).replace(/^>/, '') }); i = end + 4; continue; }
                }
                if (settings.customColors && text[i] === '<' && text.substring(i, i + 6) === '<color') {
                    const match = text.substring(i).match(/<color:([A-Fa-f0-9]{6})>/);
                    if (match) { const end = text.indexOf('</color>', i); if (end !== -1) { result.push({ type: 'color', text: text.substring(i + match[0].length, end), color: match[1] }); i = end + 8; continue; } }
                }
                if (text[i] === '`') {
                    const end = text.indexOf('`', i + 1);
                    if (end !== -1) { result.push({ type: 'code', text: text.substring(i + 1, end) }); i = end + 1; continue; }
                }
                if (settings.makeHyperlinks && text[i] === '[') {
                    const close = text.indexOf(']', i);
                    if (close !== -1 && text[close + 1] === '(') { const urlEnd = text.indexOf(')', close); if (urlEnd !== -1) { result.push({ type: 'hyperlink', text: text.substring(i + 1, close), url: text.substring(close + 2, urlEnd) }); i = urlEnd + 1; continue; } }
                }
                let regular = '';
                while (i < text.length && text[i] !== '*' && text[i] !== '[' && text[i] !== '`' && !(text[i] === '<')) { regular += text[i]; i++; }
                if (regular) result.push({ type: 'text', text: regular });
            }
            return result;
        }

        function formatToXml(text) {
            const parts = parseFormatting(text);
            let xml = '';
            for (const p of parts) {
                if (p.type === 'bold') xml += '<w:r><w:rPr><w:b/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'italic') xml += '<w:r><w:rPr><w:i/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'strike') xml += '<w:r><w:rPr><w:strike/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'underline') xml += '<w:r><w:rPr><w:u/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'code') xml += '<w:r><w:rPr><w:rFonts w:ascii="Courier New"/><w:color w:val="C7254E"/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'color') xml += '<w:r><w:rPr><w:color w:val="' + p.color + '"/></w:rPr><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                else if (p.type === 'hyperlink') xml += '<w:r><w:rPr><w:rStyle w:val="Hyperlink"/><w:color w:val="0563C1"/><w:u/></w:rPr><w:t>' + escapeXml(p.text) + '</w:t></w:r>';
                else xml += '<w:r><w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
            }
            return xml;
        }

        function getIndent(line) { return Math.floor((line.match(/^(\s*)/)[1].length) / 4); }

        function getContentTypes() {
            return '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/><Default Extension="xml" ContentType="application/xml"/><Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/><Override PartName="/word/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/><Override PartName="/word/numbering.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml"/></Types>';
        }

        function getRels() {
            return '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/></Relationships>';
        }

        function getDocRels() {
            return '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering" Target="numbering.xml"/></Relationships>';
        }

        function getNumbering() {
            return '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><w:numbering xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"><w:abstractNum w:abstractNumId="0"><w:nsimple/><w:lvl w:ilvl="0"><w:start w:val="1"/><w:numFmt w:val="decimal"/><w:lvlText w:val="%1."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="720" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="1"><w:start w:val="1"/><w:numFmt w:val="lowerLetter"/><w:lvlText w:val="%2."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="1440" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="2"><w:start w:val="1"/><w:numFmt w:val="lowerRoman"/><w:lvlText w:val="%3."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2160" w:hanging="360"/></w:pPr></w:lvl></w:abstractNum><w:abstractNum w:abstractNumId="1"><w:nsimple/><w:lvl w:ilvl="0"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚Ä¢"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="720" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="1"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚ó¶"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="1440" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="2"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚ñ™"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2160" w:hanging="360"/></w:pPr></w:lvl></w:abstractNum><w:abstractNum w:abstractNumId="2"><w:nsimple/><w:lvl w:ilvl="0"><w:start w:val="1"/><w:numFmt w:val="decimal"/><w:lvlText w:val="%1."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="1440" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="1"><w:start w:val="1"/><w:numFmt w:val="lowerLetter"/><w:lvlText w:val="%2."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2160" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="2"><w:start w:val="1"/><w:numFmt w:val="lowerRoman"/><w:lvlText w:val="%3."/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2880" w:hanging="360"/></w:pPr></w:lvl></w:abstractNum><w:abstractNum w:abstractNumId="3"><w:nsimple/><w:lvl w:ilvl="0"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚Ä¢"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="1440" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="1"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚ó¶"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2160" w:hanging="360"/></w:pPr></w:lvl><w:lvl w:ilvl="2"><w:start w:val="1"/><w:numFmt w:val="bullet"/><w:lvlText w:val="‚ñ™"/><w:lvlJc w:val="left"/><w:pPr><w:ind w:left="2880" w:hanging="360"/></w:pPr></w:lvl></w:abstractNum><w:num w:numId="1"><w:abstractNumId w:val="0"/></w:num><w:num w:numId="2"><w:abstractNumId w:val="1"/></w:num><w:num w:numId="3"><w:abstractNumId w:val="2"/></w:num><w:num w:numId="4"><w:abstractNumId w:val="3"/></w:num></w:numbering>';
        }

        function getStyles() {
            return '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><w:styles xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main"><w:docDefaults><w:rPrDefault><w:rPr><w:rFonts w:ascii="Calibri" w:hAnsi="Calibri"/><w:sz w:val="22"/></w:rPr></w:rPrDefault></w:docDefaults><w:style w:type="paragraph" w:styleId="Normal"><w:name w:val="Normal"/><w:qFormat/><w:pPr><w:spacing w:line="240" w:lineRule="auto"/></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Title"><w:name w:val="Title"/><w:basedOn w:val="Normal"/><w:rPr><w:b/><w:sz w:val="40"/><w:color w:val="2F5496"/></w:rPr><w:pPr><w:spacing w:before="0" w:after="120" w:line="240" w:lineRule="auto"/><w:jc w:val="left"/></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Heading1"><w:name w:val="Heading 1"/><w:basedOn w:val="Normal"/><w:rPr><w:b/><w:sz w:val="32"/><w:color w:val="2F5496"/></w:rPr><w:pPr><w:spacing w:before="120" w:after="80" w:line="240" w:lineRule="auto"/></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Heading2"><w:name w:val="Heading 2"/><w:basedOn w:val="Normal"/><w:rPr><w:b/><w:sz w:val="28"/><w:color w:val="44546A"/></w:rPr><w:pPr><w:spacing w:before="100" w:after="60" w:line="240" w:lineRule="auto"/></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Heading3"><w:name w:val="Heading 3"/><w:basedOn w:val="Normal"/><w:rPr><w:b/><w:sz w:val="26"/><w:color w:val="44546A"/></w:rPr><w:pPr><w:spacing w:before="80" w:after="40" w:line="240" w:lineRule="auto"/></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Quote"><w:name w:val="Quote"/><w:basedOn w:val="Normal"/><w:rPr><w:i/><w:color w:val="404040"/></w:rPr><w:pPr><w:ind w:left="720"/><w:spacing w:before="60" w:after="60" w:line="240" w:lineRule="auto"/><w:pBdr><w:left w:val="single" w:sz="12" w:space="1" w:color="C0C0C0"/></w:pBdr></w:pPr></w:style><w:style w:type="paragraph" w:styleId="Code"><w:name w:val="Code"/><w:basedOn w:val="Normal"/><w:rPr><w:rFonts w:ascii="Courier New" w:hAnsi="Courier New"/><w:color w:val="C65911"/><w:sz w:val="20"/></w:rPr><w:pPr><w:spacing w:before="80" w:after="80" w:line="240" w:lineRule="auto"/><w:shd w:fill="F2F2F2"/><w:pBdr><w:top w:val="single" w:sz="6" w:space="1" w:color="E0E0E0"/><w:bottom w:val="single" w:sz="6" w:space="1" w:color="E0E0E0"/><w:left w:val="single" w:sz="6" w:space="1" w:color="E0E0E0"/><w:right w:val="single" w:sz="6" w:space="1" w:color="E0E0E0"/></w:pBdr></w:pPr></w:style><w:style w:type="paragraph" w:styleId="ListParagraph"><w:name w:val="List Paragraph"/><w:basedOn w:val="Normal"/><w:pPr><w:spacing w:line="240" w:lineRule="auto"/></w:pPr></w:style><w:style w:type="character" w:styleId="Hyperlink"><w:name w:val="Hyperlink"/><w:rPr><w:color w:val="0563C1"/><w:u/></w:rPr></w:style></w:styles>';
        }

        function getWordDoc(md) {
            let xml = '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><w:body>';
            const lines = md.split('\n');
            let inTable = false, tableRows = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trim = line.trim();
                const indent = getIndent(line);

                if (inTable && !trim.includes('|')) {
                    if (tableRows.length > 0) {
                        let tbl = '<w:tbl><w:tblPr><w:tblW w:w="5000" w:type="auto"/></w:tblPr>';
                        tableRows.forEach((row, ridx) => {
                            tbl += '<w:tr>';
                            row.forEach(cell => {
                                const isHeader = ridx === 0;
                                tbl += '<w:tc><w:tcPr><w:tcW w:w="1000" w:type="auto"/><w:shd w:fill="' + (isHeader ? '4472C4' : 'FFFFFF') + '"/></w:tcPr><w:p><w:pPr><w:jc w:val="center"/></w:pPr>';
                                const parts = parseFormatting(cell);
                                parts.forEach(p => {
                                    let rpr = '<w:rPr>' + (isHeader ? '<w:b/><w:color w:val="FFFFFF"/>' : '') + '<w:sz w:val="22"/></w:rPr>';
                                    if (p.type === 'bold') rpr = '<w:rPr><w:b/>' + (isHeader ? '<w:color w:val="FFFFFF"/>' : '') + '<w:sz w:val="22"/></w:rPr>';
                                    tbl += '<w:r>' + rpr + '<w:t xml:space="preserve">' + escapeXml(p.text) + '</w:t></w:r>';
                                });
                                tbl += '</w:p></w:tc>';
                            });
                            tbl += '</w:tr>';
                        });
                        tbl += '</w:tbl>';
                        xml += tbl;
                    }
                    tableRows = [];
                    inTable = false;
                }

                if (settings.pageBreaks && trim === '<!-- pagebreak -->') {
                    xml += '<w:p><w:pPr><w:pageBreakBefore/></w:pPr></w:p>';
                } else if (trim.match(/^#\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Title"/></w:pPr>' + formatToXml(trim.replace(/^#\s/, '')) + '</w:p>';
                } else if (trim.match(/^##\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Heading1"/></w:pPr>' + formatToXml(trim.replace(/^##\s/, '')) + '</w:p>';
                } else if (trim.match(/^###\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Heading2"/></w:pPr>' + formatToXml(trim.replace(/^###\s/, '')) + '</w:p>';
                } else if (trim.match(/^####\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Heading3"/></w:pPr>' + formatToXml(trim.replace(/^####\s/, '')) + '</w:p>';
                } else if (trim.match(/^\d+\.\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="ListParagraph"/><w:numPr><w:ilvl w:val="' + indent + '"/><w:numId w:val="' + (indent > 0 ? '3' : '1') + '"/></w:numPr><w:ind w:left="' + (indent * 720) + '" w:hanging="360"/></w:pPr>' + formatToXml(trim.replace(/^\d+\.\s/, '')) + '</w:p>';
                } else if (trim.match(/^[\*\-\+]\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="ListParagraph"/><w:numPr><w:ilvl w:val="' + indent + '"/><w:numId w:val="' + (indent > 0 ? '4' : '2') + '"/></w:numPr><w:ind w:left="' + (indent * 720) + '" w:hanging="360"/></w:pPr>' + formatToXml(trim.replace(/^[\*\-\+]\s/, '')) + '</w:p>';
                } else if (trim.match(/^>\s/)) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Quote"/></w:pPr>' + formatToXml(trim.replace(/^>\s/, '')) + '</w:p>';
                } else if (trim.startsWith('```')) {
                    i++;
                    const code = [];
                    while (i < lines.length && !lines[i].trim().startsWith('```')) { code.push(escapeXml(lines[i])); i++; }
                    xml += '<w:p><w:pPr><w:pStyle w:val="Code"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="Courier New"/></w:rPr><w:t>' + code.join('\n') + '</w:t></w:r></w:p>';
                } else if (trim.includes('|')) {
                    inTable = true;
                    const cells = trim.split('|').filter(c => c.trim() && !c.match(/^-+$/));
                    if (cells.length > 0) tableRows.push(cells.map(c => c.trim()));
                } else if (trim.match(/^---+$/)) {
                    xml += '<w:p><w:pPr><w:pBdr><w:bottom w:val="single" w:sz="12" w:space="1" w:color="C0C0C0"/></w:pBdr></w:pPr></w:p>';
                } else if (trim) {
                    xml += '<w:p><w:pPr><w:pStyle w:val="Normal"/>' + (indent > 0 ? '<w:ind w:left="' + (indent * 720) + '"/>' : '') + '</w:pPr>' + formatToXml(trim) + '</w:p>';
                }
            }

            xml += '</w:body></w:document>';
            return xml;
        }
    </script>
</body>
</html>
