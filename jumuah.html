<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Khutbah Translator">
    <meta name="application-name" content="Khutbah Translator">
    <meta name="theme-color" content="#1e5936">
	<link rel="manifest" href="/manifest.json">
    <title>Khutbah Live Translator - For Muslims Worldwide</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #1e5936;
            --secondary-green: #2a7f4e;
            --gold: #d4af37;
            --light-gold: #f4e4c1;
            --cream: #faf8f3;
            --dark-text: #1a1a1a;
            --font-size: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e5936 0%, #2a7f4e 50%, #3a9960 100%);
            min-height: 100vh;
            position: relative;
            overflow-y: auto;
        }

        /* Islamic pattern background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(212, 175, 55, 0.05) 35px, rgba(212, 175, 55, 0.05) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(212, 175, 55, 0.03) 35px, rgba(212, 175, 55, 0.03) 70px);
            pointer-events: none;
            z-index: 1;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
            min-height: auto;
            display: none;
        }

        .app-container.active {
            display: block;
        }

        /* Header with Islamic design */
        .header {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '☪';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 100px;
            opacity: 0.1;
            transform: rotate(-15deg);
        }

        .header::after {
            content: '☪';
            position: absolute;
            bottom: -20px;
            left: -20px;
            font-size: 100px;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .header h1 {
            font-family: 'Amiri', serif;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-style: italic;
        }

        /* Navigation tabs */
        .nav-tabs {
            display: flex;
            background: var(--cream);
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .nav-tab:hover {
            background: rgba(30, 89, 54, 0.1);
        }

        .nav-tab.active {
            background: var(--primary-green);
            color: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid white;
        }

        /* Main content area */
        .content-area {
            background: white;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 500px;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* Controls section */
        .controls {
            padding: 20px;
            background: linear-gradient(to bottom, var(--cream), white);
            border-bottom: 2px solid var(--light-gold);
        }
		.sentence.interim {
		opacity: 0.6;
		background: rgba(212, 175, 55, 0.1);
		}	

        .lang-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .lang-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .lang-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .lang-label::before {
            content: '◈';
            color: var(--gold);
        }

        .lang-select {
            height: 45px;
            padding: 0 15px;
            border: 2px solid var(--light-gold);
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .lang-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        /* Status indicator */
        .status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05));
            border-radius: 10px;
            border: 1px solid var(--light-gold);
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--secondary-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .status-dot.active {
            background: var(--gold);
            box-shadow: 0 0 10px var(--gold);
        }

        .status-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-green);
        }

        /* Translation area */
        .translation-area {
            padding: 20px;
            height: 400px;
            position: relative;
        }

        .translation-panel {
            height: 100%;
            border: 2px solid var(--light-gold);
            border-radius: 15px;
            padding: 15px;
            background: linear-gradient(to bottom, white, var(--cream));
            position: relative;
        }

        .panel-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 20px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .font-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-green);
            transition: all 0.3s;
        }

        .font-btn:hover {
            background: var(--light-gold);
            border-radius: 50%;
        }

        .font-size-value {
            width: 40px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-green);
        }

        .panel-header {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary-green);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gold);
        }

        .text-content {
            height: calc(100% - 80px);
            overflow-y: auto;
            font-size: var(--font-size);
            line-height: 1.8;
            color: var(--dark-text);
            padding-right: 10px;
            scroll-behavior: smooth;
        }

        .text-content::-webkit-scrollbar {
            width: 8px;
        }

        .text-content::-webkit-scrollbar-track {
            background: var(--cream);
            border-radius: 4px;
        }

        .text-content::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        .sentence {
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(244, 228, 193, 0.2);
            border-radius: 8px;
            border-left: 3px solid var(--gold);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .sentence:last-child {
            background: rgba(212, 175, 55, 0.15);
        }

        .rtl {
            direction: rtl;
            text-align: right;
            font-family: 'Amiri', serif;
            border-left: none;
            border-right: 3px solid var(--gold);
        }

        .empty {
            color: #999;
            font-style: italic;
            text-align: center;
            margin-top: 50px;
        }

        /* Settings page */
        .settings-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .setting-group {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--cream);
            border-radius: 10px;
            border: 1px solid var(--light-gold);
        }

        .setting-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-green);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-title::before {
            content: '⚙️';
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .language-option {
            padding: 12px;
            background: white;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .language-option:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .language-option.selected {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        /* Contact page */
        .about-content {
            max-width: 700px;
            margin: 0 auto;
            padding: 30px;
            text-align: center;
        }

        .about-content h2 {
            font-family: 'Amiri', serif;
            font-size: 32px;
            color: var(--primary-green);
            margin-bottom: 20px;
        }

        .about-content p {
            font-size: 16px;
            line-height: 1.8;
            color: #555;
            margin-bottom: 20px;
        }

        .developer-info {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--cream), white);
            border-radius: 15px;
            border: 2px solid var(--light-gold);
        }

        .developer-info h3 {
            font-size: 20px;
            color: var(--primary-green);
            margin-bottom: 15px;
        }

        .bismillah {
            font-family: 'Amiri', serif;
            font-size: 24px;
            color: var(--gold);
            margin: 20px 0;
        }

        /* Visitor Counter Styles */
        .visitor-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s;
        }

        .visitor-counter:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .visitor-count {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .visitor-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Visitor Stats Modal */
        .stats-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .stats-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .stats-header {
            font-family: 'Amiri', serif;
            font-size: 28px;
            color: var(--primary-green);
            text-align: center;
            margin-bottom: 20px;
        }

        .country-list {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .country-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--cream);
            border-radius: 10px;
            border-left: 4px solid var(--gold);
        }

        .country-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--primary-green);
        }

        .country-count {
            background: var(--primary-green);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        /* Donation Section Styles */
        .donation-section {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
            padding: 30px;
            border-radius: 20px;
            border: 3px solid var(--gold);
            margin-top: 30px;
            text-align: center;
        }

        .donation-title {
            font-family: 'Amiri', serif;
            font-size: 28px;
            color: var(--primary-green);
            margin-bottom: 15px;
        }

        .donation-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
            font-style: italic;
        }

        .donation-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .donation-method {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--light-gold);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--primary-green);
        }

        .donation-method:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
            border-color: var(--gold);
        }

        .donation-method-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .donation-method-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .donation-method-info {
            font-size: 12px;
            color: #666;
        }

        .crypto-address {
            background: var(--cream);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            word-break: break-all;
            font-family: monospace;
            font-size: 10px;
        }

        .copy-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        .copy-btn:hover {
            background: var(--secondary-green);
        }

        .close-modal {
            background: var(--gold);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 20px;
        }

        .close-modal:hover {
            background: #c49f30;
        }

        /* Action buttons */
        .actions {
            padding: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 89, 54, 0.3);
        }

        .btn-secondary {
            background: var(--gold);
            color: white;
        }

        .btn-secondary:hover {
            background: #c49f30;
            transform: translateY(-2px);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .header h1 {
                font-size: 28px;
            }

            .lang-row {
                grid-template-columns: 1fr;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .nav-tab {
                font-size: 12px;
                padding: 12px 10px;
            }

            .translation-area {
                height: 350px;
            }
        }

        /* Loading animation */
        .loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        .loader.active {
            display: block;
        }

        .loader-circle {
            width: 60px;
            height: 60px;
            border: 5px solid var(--cream);
            border-top: 5px solid var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
					#addToHomeScreenBtn {
				width: 100%;
				justify-content: center;
			}
			#iosInstructions {
				text-align: center;
				line-height: 1.6;
			}
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div class="loader-circle"></div>
    </div>

    <!-- Main Translator Page -->
    <div class="app-container active" id="mainPage">
        <div class="header">
            <h1>مترجم الخطبة الحي</h1>
            <h1>Khutbah Live Translator</h1>
            <p>Bridging hearts across languages in the House of Allah</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('translator')">Translator</button>
            <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
            <button class="nav-tab" onclick="switchTab('about')">About</button>
            <button class="nav-tab" onclick="switchTab('contact')">Contact</button>
        </div>

        <div class="content-area">
            <!-- Translator Tab -->
            <div class="tab-content active" id="translatorTab">
                <div class="controls">
                    <div class="lang-row">
                        <div class="lang-group">
                            <label class="lang-label">Source Language</label>
                            <select class="lang-select" id="inputLang">
                                <option value="ar-SA">Arabic (Saudi)</option>
                                <option value="ar-EG">Arabic (Egyptian)</option>
                                <option value="ar-AE">Arabic (UAE)</option>
                                <option value="ar-MA">Arabic (Moroccan)</option>
                                <option value="en-US">English</option>
                                <option value="ur-PK">Urdu</option>
                                <option value="id-ID">Indonesian</option>
                                <option value="ms-MY">Malay</option>
                                <option value="tr-TR">Turkish</option>
                                <option value="fa-IR">Farsi/Persian</option>
                                <option value="bn-BD">Bengali</option>
                                <option value="ps-AF">Pashto</option>
                                <option value="so-SO">Somali</option>
                                <option value="ha-NG">Hausa</option>
                                <option value="sw-KE">Swahili</option>
                                <option value="az-AZ">Azerbaijani</option>
                                <option value="uz-UZ">Uzbek</option>
                                <option value="kk-KZ">Kazakh</option>
                                <option value="ky-KG">Kyrgyz</option>
                                <option value="tg-TJ">Tajik</option>
                                <option value="fr-FR">French</option>
                                <option value="de-DE">German</option>
                                <option value="es-ES">Spanish</option>
                                <option value="ru-RU">Russian</option>
                                <option value="zh-CN">Chinese (Mandarin)</option>
                                <option value="hi-IN">Hindi</option>
                            </select>
                        </div>

                        <div class="lang-group">
                            <label class="lang-label">Translation Language</label>
                            <select class="lang-select" id="outputLang">
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                                <option value="ur">Urdu</option>
                                <option value="id">Indonesian</option>
                                <option value="ms">Malay</option>
                                <option value="tr">Turkish</option>
                                <option value="fa">Farsi/Persian</option>
                                <option value="bn">Bengali</option>
                                <option value="ps">Pashto</option>
                                <option value="so">Somali</option>
                                <option value="ha">Hausa</option>
                                <option value="sw">Swahili</option>
                                <option value="az">Azerbaijani</option>
                                <option value="uz">Uzbek</option>
                                <option value="kk">Kazakh</option>
                                <option value="ky">Kyrgyz</option>
                                <option value="tg">Tajik</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="es">Spanish</option>
                                <option value="ru">Russian</option>
                                <option value="zh">Chinese</option>
                                <option value="hi">Hindi</option>
                            </select>
                        </div>
                    </div>

                    <div class="status">
                        <div class="status-info">
                            <div class="status-dot" id="statusDot"></div>
                            <span class="status-text" id="statusText">Ready to listen</span>
                        </div>
                    </div>
                </div>

                <div class="translation-area">
                    <div class="translation-panel">
                        <div class="panel-controls">
                            <div class="font-size-control">
                                <button class="font-btn" onclick="changeFontSize(-2)">−</button>
                                <span class="font-size-value" id="fontSizeValue">16px</span>
                                <button class="font-btn" onclick="changeFontSize(2)">+</button>
                            </div>
                        </div>
                        <div class="panel-header">Live Translation</div>
                        <div class="text-content" id="translatedText">
                            <div class="empty">Waiting for speech to translate...</div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn btn-secondary" id="saveBtn">
                        <span>💾</span>
                        Save Transcript
                    </button>
                    <button class="btn btn-secondary" id="recordBtn">
                        <span>⏺️</span>
                        <span id="recordText">Record Audio</span>
                    </button>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settingsTab">
                <div class="settings-content">
                    <div class="setting-group">
                        <div class="setting-title">Interface Language</div>
                        <div class="language-grid">
                            <div class="language-option selected" onclick="setInterfaceLanguage('en')">English</div>
                            <div class="language-option" onclick="setInterfaceLanguage('ar')">العربية</div>
                            <div class="language-option" onclick="setInterfaceLanguage('ur')">اردو</div>
                            <div class="language-option" onclick="setInterfaceLanguage('id')">Bahasa Indonesia</div>
                            <div class="language-option" onclick="setInterfaceLanguage('tr')">Türkçe</div>
                            <div class="language-option" onclick="setInterfaceLanguage('ms')">Bahasa Melayu</div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-title">Auto-Detection Settings</div>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="autoDetectDialects" checked>
                            <span>Auto-detect regional dialects</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <input type="checkbox" id="instantTranslate" checked>
                            <span>Instant translation (no delay)</span>
                        </label>
                    </div>

                    <div class="setting-group">
                        <div class="setting-title">Display Settings</div>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="autoScroll" checked>
                            <span>Auto-scroll to latest translation</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <input type="checkbox" id="highlightLatest" checked>
                            <span>Highlight latest translation</span>
                        </label>
                    </div>

                    <div class="setting-group">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>
					<div class="setting-group">
						<div class="setting-title">Add to Home Screen</div>
						<button class="btn btn-primary" id="addToHomeScreenBtn">
							<span>📱</span> Add App to Home Screen
						</button>
						<p id="iosInstructions" style="display: none; font-size: 14px; color: #666; margin-top: 10px;">
							For iOS: Tap the <strong>Share</strong> icon in Safari, then select <strong>Add to Home Screen</strong>.
						</p>
					</div>
                </div>
            </div>

            <!-- About Tab -->
            <div class="tab-content" id="aboutTab">
                <div class="about-content">
                    <div class="bismillah">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
                    <h2>About Khutbah Live Translator</h2>
                    
                    <div class="developer-info">
                        <h3>Developer's Story</h3>
                        <p>
                            My name is <strong>Khaled Diab</strong>, an Arab Muslim developer. This application was born from a moment of profound realization during a Jumu'ah prayer in Dubai.
                        </p>
                        <p>
                            I was moved when a Muslim brother shared with me that he couldn't understand a single word of what the Sheikh was saying during the khutbah. Despite being in the same congregation, praising the same Allah, the language barrier prevented him from receiving the spiritual guidance being shared.
                        </p>
                        <p>
                            This encounter inspired me to create this tool - a bridge for Muslims worldwide to understand the beautiful messages delivered in our mosques, regardless of the language they speak. It's my humble contribution to unite the Ummah and ensure that no Muslim feels excluded from understanding the word of Allah and the teachings of our Prophet ﷺ.
                        </p>
                        <p style="margin-top: 20px; font-style: italic; color: var(--primary-green);">
                            "وَمَا أَرْسَلْنَاكَ إِلَّا رَحْمَةً لِّلْعَالَمِينَ"<br>
                            "And We have not sent you, [O Muhammad], except as a mercy to the worlds."<br>
                            - Quran 21:107
                        </p>
                    </div>

                    <p style="margin-top: 30px; font-size: 14px; color: #777;">
                        May Allah accept this work and make it beneficial for all Muslims. Ameen.
                    </p>
                </div>
            </div>

            <!-- Contact Tab -->
            <div class="tab-content" id="contactTab">
                <div class="contact-content" style="max-width: 700px; margin: 0 auto; padding: 30px;">
                    <h2 style="font-family: 'Amiri', serif; font-size: 32px; color: var(--primary-green); text-align: center; margin-bottom: 30px;">
                        Contact Developer
                    </h2>
                    
                    <div style="background: var(--cream); padding: 30px; border-radius: 15px; border: 2px solid var(--light-gold); margin-bottom: 30px;">
                        <h3 style="font-size: 24px; color: var(--primary-green); margin-bottom: 20px; text-align: center;">
                            Khaled Diab
                        </h3>
                        
                        <div style="display: grid; gap: 20px;">
                            <!-- Email -->
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: white; border-radius: 10px;">
                                <span style="font-size: 24px;">📧</span>
                                <div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Email</div>
                                    <a href="mailto:khaled.mohamed.rady@outlook.com" style="color: var(--primary-green); text-decoration: none; font-weight: 600;">
                                        khaled.mohamed.rady@outlook.com
                                    </a>
                                </div>
                            </div>
                            
                            <!-- WhatsApp -->
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: white; border-radius: 10px;">
                                <span style="font-size: 24px;">💬</span>
                                <div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">WhatsApp</div>
                                    <a href="https://wa.me/966540015033" style="color: var(--primary-green); text-decoration: none; font-weight: 600;">
                                        +955 5400 15 033
                                    </a>
                                </div>
                            </div>
                            
                            <!-- LinkedIn -->
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: white; border-radius: 10px;">
                                <span style="font-size: 24px;">💼</span>
                                <div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">LinkedIn</div>
                                    <a href="https://www.linkedin.com/in/dr-khaled-diab/" style="color: var(--primary-green); text-decoration: none; font-weight: 600;">
                                        linkedin.com/in/dr-khaled-diab
                                    </a>
                                </div>
                            </div>
                            
                            <!-- GitHub -->
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: white; border-radius: 10px;">
                                <span style="font-size: 24px;">🔧</span>
                                <div>
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">GitHub</div>
                                    <a href="https://github.com/khalecl" style="color: var(--primary-green); text-decoration: none; font-weight: 600;">
                                        github.com/khalecl
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Donation Section -->
                    <div class="donation-section">
                        <div class="donation-title">💚 Support This Project</div>
                        <div class="donation-subtitle">
                            "The example of those who spend their wealth in the way of Allah is like a seed which grows seven spikes"<br>
                            - Quran 2:261
                        </div>
                        
                        <div class="donation-methods">
                            <!-- PayPal -->
                            <a href="https://paypal.me/khaleddiab" class="donation-method" target="_blank">
                                <div class="donation-method-icon">💳</div>
                                <div class="donation-method-name">PayPal</div>
                                <div class="donation-method-info">Quick & Easy</div>
                            </a>
                            
                            <!-- Patreon -->
                            <a href="https://patreon.com/khaleddiab" class="donation-method" target="_blank">
                                <div class="donation-method-icon">🎯</div>
                                <div class="donation-method-name">Patreon</div>
                                <div class="donation-method-info">Monthly Support</div>
                            </a>
                            
                            <!-- Bitcoin -->
                            <div class="donation-method" onclick="showCryptoAddress('bitcoin')">
                                <div class="donation-method-icon">₿</div>
                                <div class="donation-method-name">Bitcoin</div>
                                <div class="donation-method-info">Cryptocurrency</div>
                                <div id="bitcoin-address" style="display: none;">
                                    <div class="crypto-address">
                                        bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh
                                    </div>
                                    <button class="copy-btn" onclick="copyToClipboard('bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', event)">
                                        Copy Address
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Bank Transfer -->
                            <div class="donation-method" onclick="alert('Please contact me via email for bank transfer details')">
                                <div class="donation-method-icon">🏦</div>
                                <div class="donation-method-name">Bank Transfer</div>
                                <div class="donation-method-info">Direct Transfer</div>
                            </div>
                        </div>
                        
                        <p style="margin-top: 20px; font-size: 14px; color: #666;">
                            Your support helps maintain and improve this free service for the Muslim community worldwide.<br>
                            May Allah reward you abundantly for your generosity. 
                        </p>
                    </div>
                    
                    <!-- Feedback Section -->
                    <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05)); padding: 30px; border-radius: 15px; border: 2px solid var(--light-gold); margin-top: 30px;">
                        <h3 style="font-size: 20px; color: var(--primary-green); margin-bottom: 20px; text-align: center;">
                            Send Feedback
                        </h3>
                        
                        <div style="display: grid; gap: 15px;">
                            <input type="text" id="feedbackName" placeholder="Your Name" 
                                style="padding: 12px; border: 2px solid var(--light-gold); border-radius: 8px; font-size: 15px;">
                            
                            <input type="email" id="feedbackEmail" placeholder="Your Email" 
                                style="padding: 12px; border: 2px solid var(--light-gold); border-radius: 8px; font-size: 15px;">
                            
                            <select id="feedbackType" 
                                style="padding: 12px; border: 2px solid var(--light-gold); border-radius: 8px; font-size: 15px; background: white;">
                                <option value="">Select Feedback Type</option>
                                <option value="bug">Bug Report</option>
                                <option value="feature">Feature Request</option>
                                <option value="translation">Translation Issue</option>
                                <option value="general">General Feedback</option>
                                <option value="collaboration">Collaboration</option>
                            </select>
                            
                            <textarea id="feedbackMessage" placeholder="Your message..." rows="5"
                                style="padding: 12px; border: 2px solid var(--light-gold); border-radius: 8px; font-size: 15px; resize: vertical;">
                            </textarea>
                            
                            <button onclick="sendFeedback()" class="btn btn-primary" style="width: 100%;">
                                Send Message
                            </button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; padding: 20px; background: white; border-radius: 10px;">
                        <p style="color: #666; margin-bottom: 10px;">
                            "The believers are but brothers"<br>
                            - Quran 49:10
                        </p>
                        <p style="font-size: 14px; color: #999;">
                            Feel free to reach out with any suggestions, bug reports, or if you'd like to contribute to making this app better for the Muslim community worldwide.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visitor Counter -->
    <div class="visitor-counter" onclick="showVisitorStats()">
        <div class="visitor-count" id="visitorCount">0</div>
        <div class="visitor-label">Visitors Worldwide</div>
    </div>

    <!-- Visitor Stats Modal -->
    <div class="stats-modal" id="statsModal">
        <div class="stats-content">
            <div class="stats-header">
                🌍 Visitors From Around The World
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 36px; color: var(--gold); font-weight: bold;" id="totalVisitors">0</div>
                <div style="color: #666;">Total Visitors</div>
            </div>
            <div class="country-list" id="countryList">
                <!-- Countries will be populated here -->
            </div>
            <button class="close-modal" onclick="closeStatsModal()">Close</button>
        </div>
    </div>

    <script>
        // Initialize variables
        let recognition;
        let isListening = false;
        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];
        let translations = [];
        let currentFontSize = 16;
        let settings = {
            interfaceLanguage: 'en',
            autoDetectDialects: true,
            instantTranslate: true,  // Enabled by default
            autoScroll: true,
            highlightLatest: true
        };

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('khutbahSettings');
            if (saved) {
                settings = JSON.parse(saved);
                applySettings();
            }
        }

        // Save settings to localStorage
        function saveSettings() {
            settings.autoDetectDialects = document.getElementById('autoDetectDialects').checked;
            settings.instantTranslate = document.getElementById('instantTranslate').checked;
            settings.autoScroll = document.getElementById('autoScroll').checked;
            settings.highlightLatest = document.getElementById('highlightLatest').checked;
            
            localStorage.setItem('khutbahSettings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        // Apply settings
        function applySettings() {
            document.getElementById('autoDetectDialects').checked = settings.autoDetectDialects;
            document.getElementById('instantTranslate').checked = settings.instantTranslate;
            document.getElementById('autoScroll').checked = settings.autoScroll;
            document.getElementById('highlightLatest').checked = settings.highlightLatest;
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and contents
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Font size control
        function changeFontSize(change) {
            currentFontSize = Math.max(12, Math.min(32, currentFontSize + change));
            document.documentElement.style.setProperty('--font-size', currentFontSize + 'px');
            document.getElementById('fontSizeValue').textContent = currentFontSize + 'px';
        }

        // Interface language setting
        function setInterfaceLanguage(lang) {
            document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');
            settings.interfaceLanguage = lang;
            localStorage.setItem('khutbahSettings', JSON.stringify(settings));
            
            // Update interface texts based on language
            updateInterfaceTexts(lang);
        }

        // Update interface texts
        function updateInterfaceTexts(lang) {
            const texts = {
                en: {
                    title: 'Khutbah Live Translator',
                    subtitle: 'Bridging hearts across languages in the House of Allah',
                    translator: 'Translator',
                    settings: 'Settings',
                    about: 'About',
                    sourceLanguage: 'Source Language',
                    translationLanguage: 'Translation Language',
                    ready: 'Ready to listen',
                    listening: '🎤 Listening...',
                    save: 'Save Transcript',
                    record: 'Record Audio'
                },
                ar: {
                    title: 'مترجم الخطبة الحي',
                    subtitle: 'جسر القلوب عبر اللغات في بيت الله',
                    translator: 'المترجم',
                    settings: 'الإعدادات',
                    about: 'حول',
                    sourceLanguage: 'لغة المصدر',
                    translationLanguage: 'لغة الترجمة',
                    ready: 'جاهز للاستماع',
                    listening: '🎤 يستمع...',
                    save: 'حفظ النص',
                    record: 'تسجيل الصوت'
                }
            };
            
            // Apply texts based on selected language
            const t = texts[lang] || texts.en;
            // Update DOM elements with translations
        }

        // Initialize Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        function initializeSpeechRecognition() {
            if (!SpeechRecognition) {
                alert('Speech recognition not supported. Please use Chrome, Edge, or Safari.');
                return;
            }

            // Request microphone permission and start listening automatically
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    setupMediaRecorder(stream);
                    startListening();
                })
                .catch(error => {
                    console.error('Microphone access error:', error);
                    alert('Please allow microphone access to use the translator.');
                });
        }

        // Setup media recorder for audio recording
        function setupMediaRecorder(stream) {
            mediaRecorder = new MediaRecorder(stream);
            
            mediaRecorder.ondataavailable = (event) => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const url = URL.createObjectURL(audioBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `khutbah-${new Date().toISOString().slice(0, 10)}.webm`;
                a.click();
                audioChunks = [];
            };
        }

        // Start listening for speech
function startListening() {
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.maxAlternatives = 1;
    recognition.lang = document.getElementById('inputLang').value;

    let currentTranscript = '';
    let interimTranscript = '';
    let silenceTimer;
    let lastFinalText = '';

    recognition.onresult = (event) => {
        clearTimeout(silenceTimer);
        
        let interim = '';
        let final = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
                final += event.results[i][0].transcript + ' ';
            } else {
                interim = event.results[i][0].transcript;
            }
        }
        
        if (final) {
            currentTranscript += final;
            lastFinalText = currentTranscript.trim();
            // Immediately translate final results
            if (lastFinalText) {
                translateText(lastFinalText, true);
                currentTranscript = '';
                interimTranscript = ''; // Clear interim to avoid re-translation
            }
        } else {
            interimTranscript = interim;
            // Display interim results without translating
            if (settings.instantTranslate && interimTranscript.trim()) {
                displayTranslations(interimTranscript);
            }
        }

        // Translate interim results only after a pause
        silenceTimer = setTimeout(() => {
            const fullText = currentTranscript + interimTranscript;
            if (fullText.trim() && fullText !== lastFinalText) {
                translateText(fullText.trim(), false);
                interimTranscript = '';
            }
        }, 1500); // 1.5-second pause for interim translations
    };

    recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        if (event.error === 'no-speech') {
            setTimeout(() => {
                if (isListening) {
                    recognition.start();
                }
            }, 1000);
        }
    };

    recognition.onend = () => {
        const fullText = currentTranscript + interimTranscript;
        if (fullText.trim() && fullText !== lastFinalText) {
            translateText(fullText.trim(), false);
            currentTranscript = '';
            interimTranscript = '';
        }
        
        if (isListening) {
            setTimeout(() => {
                if (isListening) {
                    recognition.start();
                }
            }, 100);
        }
    };

    isListening = true;
    recognition.start();
    
    document.getElementById('statusDot').classList.add('active');
    document.getElementById('statusText').textContent = '🎤 Listening...';
}

// Translate text
async function translateText(text, isFinal) {
    if (!text || !text.trim()) return;
    
    const sourceLang = document.getElementById('inputLang').value.split('-')[0];
    const targetLang = document.getElementById('outputLang').value;

    if (sourceLang === targetLang) {
        addTranslation(text, text, isFinal);
        return;
    }

    try {
        document.getElementById('loader').classList.add('active');
        
        const response = await fetch(
            `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLang}|${targetLang}`
        );
        
        const data = await response.json();
        
        if (data.responseStatus === 200 && data.responseData) {
            addTranslation(text, data.responseData.translatedText, isFinal);
        } else {
            addTranslation(text, text, isFinal);
        }
    } catch (error) {
        console.error('Translation error:', error);
        addTranslation(text, text, isFinal);
    } finally {
        document.getElementById('loader').classList.remove('active');
    }
}


// Add translation to display
function addTranslation(originalText, translatedText, isFinal) {
    // Normalize for duplicate checking
    const normalizedOriginal = originalText.trim().toLowerCase();
    
    // Check if there's an interim translation with similar original text
    const existingIndex = translations.findIndex(t => 
        t.normalizedOriginal === normalizedOriginal && t.isInterim
    );
    
    if (existingIndex !== -1) {
        // Replace interim translation with final or more complete version
        if (isFinal || originalText.length > translations[existingIndex].originalText.length) {
            translations.splice(existingIndex, 1);
        }
    }
    
    // Check for exact duplicates (final or interim)
    const isDuplicate = translations.some(t => 
        t.normalizedOriginal === normalizedOriginal && 
        t.text.trim().toLowerCase() === translatedText.trim().toLowerCase()
    );
    
    if (!isDuplicate) {
        translations.push({
            originalText: originalText.trim(),
            text: translatedText.trim(),
            normalizedOriginal: normalizedOriginal,
            timestamp: new Date().toLocaleTimeString(),
            isInterim: !isFinal
        });
        
        displayTranslations();
    }
}

 // Display translations
function displayTranslations(interimText = '') {
    const container = document.getElementById('translatedText');
    const targetLang = document.getElementById('outputLang').value;
    const isRTL = ['ar', 'ur', 'fa', 'ps'].includes(targetLang);
    
    if (translations.length === 0 && !interimText) {
        container.innerHTML = '<div class="empty">Waiting for speech to translate...</div>';
        return;
    }
    
    container.innerHTML = translations.map((t, i) => {
        const isLatest = i === translations.length - 1;
        return `
            <div class="sentence ${isRTL ? 'rtl' : ''} ${isLatest && settings.highlightLatest && !t.isInterim ? 'latest' : ''} ${t.isInterim ? 'interim' : ''}">
                ${t.text}
            </div>
        `;
    }).join('');
    
    // Add interim text if present
    if (interimText) {
        container.innerHTML += `
            <div class="sentence ${isRTL ? 'rtl' : ''} interim">
                ${interimText}
            </div>
        `;
    }
    
    if (settings.autoScroll) {
        container.scrollTop = container.scrollHeight;
    }
}

        // Save transcript
        document.getElementById('saveBtn').addEventListener('click', () => {
            const content = translations.map(t => `[${t.timestamp}] ${t.text}`).join('\n\n');
            const blob = new Blob([content], { type: 'text/plain; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `khutbah-transcript-${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();
        });

        // Record audio
        document.getElementById('recordBtn').addEventListener('click', () => {
            if (!mediaRecorder) {
                alert('Please allow microphone access first.');
                return;
            }
            
            if (!isRecording) {
                mediaRecorder.start();
                isRecording = true;
                document.getElementById('recordText').textContent = 'Stop Recording';
                document.getElementById('recordBtn').style.background = 'linear-gradient(135deg, #dc2626, #ef4444)';
            } else {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('recordText').textContent = 'Record Audio';
                document.getElementById('recordBtn').style.background = '';
            }
        });

        // Language change handlers
        document.getElementById('inputLang').addEventListener('change', () => {
            if (recognition && isListening) {
                recognition.lang = document.getElementById('inputLang').value;
                recognition.stop();
                setTimeout(() => recognition.start(), 100);
            }
        });

        document.getElementById('outputLang').addEventListener('change', () => {
            // Clear translations and re-translate if needed
            displayTranslations();
        });

        // Send feedback function
        function sendFeedback() {
            const name = document.getElementById('feedbackName').value;
            const email = document.getElementById('feedbackEmail').value;
            const type = document.getElementById('feedbackType').value;
            const message = document.getElementById('feedbackMessage').value;
            
            if (!name || !email || !type || !message) {
                alert('Please fill in all fields');
                return;
            }
            
            // Create mailto link
            const subject = `Khutbah Translator - ${type}: Feedback from ${name}`;
            const body = `Name: ${name}\nEmail: ${email}\nType: ${type}\n\nMessage:\n${message}`;
            const mailtoLink = `mailto:khaleddiab@example.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            window.location.href = mailtoLink;
            
            // Clear form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackEmail').value = '';
            document.getElementById('feedbackType').value = '';
            document.getElementById('feedbackMessage').value = '';
            
            alert('Thank you for your feedback! Your default email client will open to send the message.');
        }

        // Visitor Counter Functions
        let visitorData = {
            total: 0,
            countries: {}
        };

        // Initialize visitor counter
        async function initVisitorCounter() {
            // Get visitor data from localStorage (for demo purposes)
            const stored = localStorage.getItem('khutbahVisitorData');
            if (stored) {
                visitorData = JSON.parse(stored);
            } else {
                // Initialize with some demo data
                visitorData = {
                    total: 1247,
                    countries: {
                        'Saudi Arabia': 342,
                        'United Arab Emirates': 198,
                        'United States': 156,
                        'United Kingdom': 89,
                        'Malaysia': 76,
                        'Indonesia': 68,
                        'Pakistan': 54,
                        'Egypt': 47,
                        'Turkey': 43,
                        'India': 38,
                        'Bangladesh': 32,
                        'Canada': 28,
                        'Germany': 24,
                        'France': 19,
                        'Australia': 15,
                        'Qatar': 12,
                        'Kuwait': 9,
                        'Others': 17
                    }
                };
            }
            
            // Get user's country using IP geolocation API
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const country = data.country_name || 'Unknown';
                
                // Increment visitor count
                visitorData.total++;
                visitorData.countries[country] = (visitorData.countries[country] || 0) + 1;
                
                // Save to localStorage
                localStorage.setItem('khutbahVisitorData', JSON.stringify(visitorData));
            } catch (error) {
                console.log('Could not get location data');
                visitorData.total++;
                visitorData.countries['Unknown'] = (visitorData.countries['Unknown'] || 0) + 1;
            }
            
            updateVisitorDisplay();
        }

        // Update visitor counter display
        function updateVisitorDisplay() {
            const countElement = document.getElementById('visitorCount');
            if (countElement) {
                // Animate the counter
                animateCounter(countElement, 0, visitorData.total, 2000);
            }
        }

        // Animate counter
        function animateCounter(element, start, end, duration) {
            const range = end - start;
            const increment = end > start ? 1 : -1;
            const stepTime = Math.abs(Math.floor(duration / range));
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current.toLocaleString();
                if (current == end) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // Show visitor statistics modal
        function showVisitorStats() {
            const modal = document.getElementById('statsModal');
            const totalElement = document.getElementById('totalVisitors');
            const countryList = document.getElementById('countryList');
            
            modal.style.display = 'flex';
            totalElement.textContent = visitorData.total.toLocaleString();
            
            // Sort countries by visitor count
            const sortedCountries = Object.entries(visitorData.countries)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20); // Top 20 countries
            
            // Generate country list HTML
            countryList.innerHTML = sortedCountries.map(([country, count], index) => {
                const flag = getCountryFlag(country);
                const percentage = ((count / visitorData.total) * 100).toFixed(1);
                return `
                    <div class="country-item">
                        <div class="country-name">
                            <span style="font-size: 24px;">${flag}</span>
                            <span>${country}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="color: #666; font-size: 12px;">${percentage}%</span>
                            <div class="country-count">${count.toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Close stats modal
        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }

        // Get country flag emoji
        function getCountryFlag(country) {
            const flags = {
                'Saudi Arabia': '🇸🇦',
                'United Arab Emirates': '🇦🇪',
                'United States': '🇺🇸',
                'United Kingdom': '🇬🇧',
                'Malaysia': '🇲🇾',
                'Indonesia': '🇮🇩',
                'Pakistan': '🇵🇰',
                'Egypt': '🇪🇬',
                'Turkey': '🇹🇷',
                'India': '🇮🇳',
                'Bangladesh': '🇧🇩',
                'Canada': '🇨🇦',
                'Germany': '🇩🇪',
                'France': '🇫🇷',
                'Australia': '🇦🇺',
                'Qatar': '🇶🇦',
                'Kuwait': '🇰🇼',
                'Unknown': '🌍'
            };
            return flags[country] || '🌍';
        }

        // Donation Functions
        function showCryptoAddress(crypto) {
            const addressDiv = document.getElementById(`${crypto}-address`);
            if (addressDiv.style.display === 'none') {
                addressDiv.style.display = 'block';
            } else {
                addressDiv.style.display = 'none';
            }
        }

        // Copy to clipboard
        function copyToClipboard(text, event) {
            event.stopPropagation();
            navigator.clipboard.writeText(text).then(() => {
                alert('Address copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Track donation clicks (for analytics)
        function trackDonation(method) {
            // You can implement analytics tracking here
            console.log(`Donation method clicked: ${method}`);
            
            // Store donation interest in localStorage
            const donationStats = JSON.parse(localStorage.getItem('donationClicks') || '{}');
            donationStats[method] = (donationStats[method] || 0) + 1;
            localStorage.setItem('donationClicks', JSON.stringify(donationStats));
        }

		// Handle Add to Home Screen prompt
			let deferredPrompt;

			window.addEventListener('beforeinstallprompt', (event) => {
				event.preventDefault();
				deferredPrompt = event;
				document.getElementById('addToHomeScreenBtn').style.display = 'block';
			});

			document.getElementById('addToHomeScreenBtn').addEventListener('click', () => {
				if (deferredPrompt) {
					deferredPrompt.prompt();
					deferredPrompt.userChoice.then((choiceResult) => {
						if (choiceResult.outcome === 'accepted') {
							console.log('User added app to home screen');
						} else {
							console.log('User dismissed the prompt');
						}
						deferredPrompt = null;
						document.getElementById('addToHomeScreenBtn').style.display = 'none';
					});
				} else {
					if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
						document.getElementById('iosInstructions').style.display = 'block';
					} else {
						alert('To add this app to your home screen, use your browser\'s menu (e.g., "Add to Home screen" in Chrome).');
					}
				}
			});

		window.addEventListener('appinstalled', () => {
			document.getElementById('addToHomeScreenBtn').style.display = 'none';
			deferredPrompt = null;
		});

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('statsModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadSettings();
            // Start listening immediately with instant translation on by default
            settings.instantTranslate = true;
            
            // Initialize visitor counter
            initVisitorCounter();
            
            // Start speech recognition after a short delay
            setTimeout(() => {
                initializeSpeechRecognition();
            }, 500);
        });

        // Handle page visibility for mobile
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && isListening) {
                // Keep listening even when page is hidden
                console.log('Page hidden but still listening...');
            }
        });

        // Service worker for PWA support (optional)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed'));
        }
    </script>
</body>
</html>
