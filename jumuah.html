<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khutbah Live Translator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: linear-gradient(135deg, #0D9488 0%, #14B8A6 50%, #2DD4BF 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .app-container {
        width: 100%;
        max-width: 1000px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #0D9488, #14B8A6);
        color: white;
        padding: 24px;
        text-align: center;
    }

    .header h1 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .header p {
        font-size: 14px;
        opacity: 0.95;
    }

    .controls {
        padding: 24px;
        background: #F0FDFA;
        border-bottom: 2px solid #CCFBF1;
    }

    .lang-row {
        display: flex;
        gap: 16px;
        align-items: flex-end;
        margin-bottom: 16px;
    }

    .lang-group {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .lang-label {
        font-size: 13px;
        font-weight: 600;
        color: #4B5563;
    }

    .lang-select {
        height: 44px;
        padding: 0 12px;
        border: 2px solid #D1D5DB;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        background: white;
    }

    .lang-select:focus {
        outline: none;
        border-color: #0D9488;
        box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
    }

    .auto-detect {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #4B5563;
    }

    .auto-detect input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .status {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px;
        background: #D1FAE5;
        border-radius: 8px;
    }

    .status-dot {
        width: 10px;
        height: 10px;
        background: #10B981;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .status-text {
        font-size: 14px;
        font-weight: 600;
        color: #065F46;
    }

    .translation-area {
        padding: 24px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        min-height: 400px;
        max-height: 500px;
    }

    .translation-panel {
        display: flex;
        flex-direction: column;
        gap: 12px;
        border: 2px solid #E5E7EB;
        border-radius: 12px;
        padding: 16px;
        background: #FAFAFA;
    }

    .panel-header {
        font-size: 12px;
        font-weight: 700;
        color: #6B7280;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .text-content {
        flex: 1;
        overflow-y: auto;
        font-size: 16px;
        line-height: 1.8;
        color: #1F2937;
    }

    .text-content::-webkit-scrollbar {
        width: 6px;
    }

    .text-content::-webkit-scrollbar-thumb {
        background: #D1D5DB;
        border-radius: 3px;
    }

    .sentence {
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: 1px solid #E5E7EB;
    }

    .sentence:last-child {
        border-bottom: none;
    }

    .rtl {
        direction: rtl;
        text-align: right;
    }

    .empty {
        color: #9CA3AF;
        font-style: italic;
    }

    .actions {
        padding: 24px;
        background: #F9FAFB;
        border-top: 2px solid #E5E7EB;
        display: flex;
        gap: 12px;
        justify-content: center;
    }

    .btn {
        height: 44px;
        padding: 0 24px;
        font-size: 15px;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background: #0D9488;
        color: white;
    }

    .btn-primary:hover {
        background: #0F766E;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: white;
        color: #0D9488;
        border: 2px solid #0D9488;
    }

    .btn-secondary:hover {
        background: #F0FDFA;
    }

    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-content {
        background: white;
        padding: 32px;
        border-radius: 16px;
        max-width: 400px;
        text-align: center;
    }

    .modal-icon {
        font-size: 64px;
        margin-bottom: 16px;
    }

    .modal h2 {
        font-size: 24px;
        margin-bottom: 12px;
    }

    .modal p {
        color: #6B7280;
        margin-bottom: 24px;
        line-height: 1.6;
    }

    @media (max-width: 768px) {
        .translation-area {
            grid-template-columns: 1fr;
        }
        
        .lang-row {
            flex-direction: column;
        }
        
        .actions {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
    }
</style>
```

</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>Khutbah Live Translator</h1>
            <p>Real-Time Translation for Friday Sermons</p>
        </div>

```
    <div class="controls">
        <div class="lang-row">
            <div class="lang-group">
                <label class="lang-label">Sheikh's Language</label>
                <select id="inputLang" class="lang-select">
                    <option value="ar-SA">Arabic</option>
                    <option value="en-US">English</option>
                    <option value="ur-PK">Urdu</option>
                    <option value="tr-TR">Turkish</option>
                    <option value="id-ID">Indonesian</option>
                    <option value="ms-MY">Malay</option>
                    <option value="bn-BD">Bengali</option>
                    <option value="fa-IR">Persian</option>
                    <option value="ru-RU">Russian</option>
                    <option value="fr-FR">French</option>
                    <option value="es-ES">Spanish</option>
                    <option value="de-DE">German</option>
                    <option value="hi-IN">Hindi</option>
                </select>
            </div>

            <div class="lang-group">
                <label class="lang-label">Your Language</label>
                <select id="outputLang" class="lang-select">
                    <option value="en">English</option>
                    <option value="ar">Arabic</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="it">Italian</option>
                    <option value="ru">Russian</option>
                    <option value="tr">Turkish</option>
                    <option value="ur">Urdu</option>
                    <option value="id">Indonesian</option>
                    <option value="bn">Bengali</option>
                    <option value="fa">Persian</option>
                    <option value="hi">Hindi</option>
                    <option value="zh">Chinese</option>
                    <option value="pt">Portuguese</option>
                </select>
            </div>

            <div class="lang-group">
                <label class="lang-label">&nbsp;</label>
                <label class="auto-detect">
                    <input type="checkbox" id="autoDetect">
                    Auto-detect language
                </label>
            </div>
        </div>

        <div class="status">
            <div class="status-dot"></div>
            <span class="status-text">üé§ Listening...</span>
        </div>
    </div>

    <div class="translation-area">
        <div class="translation-panel">
            <div class="panel-header">Original Speech</div>
            <div class="text-content" id="originalText">
                <div class="empty">Waiting for speech...</div>
            </div>
        </div>

        <div class="translation-panel">
            <div class="panel-header">Translation</div>
            <div class="text-content" id="translatedText">
                <div class="empty">Translation will appear here...</div>
            </div>
        </div>
    </div>

    <div class="actions">
        <button class="btn btn-secondary" id="saveBtn">
            <span>üíæ</span>
            Save Transcript
        </button>
        <button class="btn btn-secondary" id="recordBtn">
            <span>‚è∫Ô∏è</span>
            <span id="recordText">Start Recording</span>
        </button>
    </div>
</div>

<div class="modal" id="micModal">
    <div class="modal-content">
        <div class="modal-icon">üé§</div>
        <h2>Microphone Access</h2>
        <p>Please allow microphone access to enable real-time translation of the khutbah.</p>
        <button class="btn btn-primary" id="enableMicBtn">Enable Microphone</button>
    </div>
</div>

<script>
    let recognition;
    let isListening = false;
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];
    let sentences = [];
    let translations = [];
    let currentSentence = '';

    const inputLang = document.getElementById('inputLang');
    const outputLang = document.getElementById('outputLang');
    const autoDetect = document.getElementById('autoDetect');
    const originalText = document.getElementById('originalText');
    const translatedText = document.getElementById('translatedText');
    const micModal = document.getElementById('micModal');
    const enableMicBtn = document.getElementById('enableMicBtn');
    const saveBtn = document.getElementById('saveBtn');
    const recordBtn = document.getElementById('recordBtn');
    const recordText = document.getElementById('recordText');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    window.addEventListener('load', () => {
        micModal.style.display = 'flex';
    });

    enableMicBtn.addEventListener('click', async () => {
        if (!SpeechRecognition) {
            alert('Speech recognition not supported. Use Chrome, Edge, or Safari.');
            return;
        }

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            micModal.style.display = 'none';
            setupMediaRecorder(stream);
            startListening();
        } catch (error) {
            alert('Microphone access denied. Please allow access and refresh.');
        }
    });

    function setupMediaRecorder(stream) {
        mediaRecorder = new MediaRecorder(stream);
        
        mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const url = URL.createObjectURL(audioBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `khutbah-${new Date().toISOString().slice(0, 10)}.webm`;
            a.click();
            audioChunks = [];
        };
    }

    function startListening() {
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = inputLang.value;

        let finalTranscript = '';

        recognition.onresult = (event) => {
            let interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    // Detect sentence end with punctuation or pause
                    if (transcript.match(/[.!?‡•§„ÄÇÿü]/) || transcript.trim().length > 0) {
                        sentences.push(transcript.trim());
                        currentSentence = transcript.trim();
                        translateSentence(currentSentence);
                    }
                    finalTranscript += transcript + ' ';
                } else {
                    interimTranscript = transcript;
                }
            }

            displaySentences();
        };

        recognition.onerror = (event) => {
            if (event.error === 'not-allowed') {
                micModal.style.display = 'flex';
            }
        };

        recognition.onend = () => {
            if (isListening) {
                recognition.start();
            }
        };

        isListening = true;
        recognition.start();
    }

    async function translateSentence(text) {
        if (!text.trim()) return;

        const sourceLang = inputLang.value.split('-')[0];
        const targetLang = outputLang.value;

        if (sourceLang === targetLang) {
            translations.push(text);
            displaySentences();
            return;
        }

        try {
            const response = await fetch(
                `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLang}|${targetLang}`
            );
            
            const data = await response.json();
            
            if (data.responseStatus === 200 && data.responseData) {
                translations.push(data.responseData.translatedText);
            } else {
                translations.push(text);
            }
            displaySentences();
        } catch (error) {
            translations.push(text);
            displaySentences();
        }
    }

    function displaySentences() {
        const sourceLang = inputLang.value;
        const targetLang = outputLang.value;
        
        const origRTL = sourceLang.startsWith('ar') || sourceLang.startsWith('ur') || sourceLang.startsWith('fa');
        const transRTL = targetLang === 'ar' || targetLang === 'ur' || targetLang === 'fa';

        originalText.innerHTML = sentences.map((s, i) => 
            `<div class="sentence ${origRTL ? 'rtl' : ''}">${s}</div>`
        ).join('') || '<div class="empty">Waiting for speech...</div>';

        translatedText.innerHTML = translations.map((t, i) => 
            `<div class="sentence ${transRTL ? 'rtl' : ''}">${t}</div>`
        ).join('') || '<div class="empty">Translation will appear here...</div>';

        // Auto-scroll to bottom
        originalText.scrollTop = originalText.scrollHeight;
        translatedText.scrollTop = translatedText.scrollHeight;
    }

    inputLang.addEventListener('change', () => {
        if (recognition && isListening) {
            recognition.lang = inputLang.value;
            recognition.stop();
            setTimeout(() => recognition.start(), 100);
        }
        displaySentences();
    });

    outputLang.addEventListener('change', () => {
        // Retranslate all sentences
        translations = [];
        sentences.forEach(s => translateSentence(s));
    });

    autoDetect.addEventListener('change', (e) => {
        if (e.target.checked) {
            alert('Auto-detect is enabled. The app will attempt to detect the language automatically.');
        }
    });

    saveBtn.addEventListener('click', () => {
        const content = sentences.map((s, i) => {
            return `${s}\n‚Üí ${translations[i] || ''}\n`;
        }).join('\n');

        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `khutbah-transcript-${new Date().toISOString().slice(0, 10)}.txt`;
        a.click();
    });

    recordBtn.addEventListener('click', () => {
        if (!isRecording) {
            mediaRecorder.start();
            isRecording = true;
            recordText.textContent = 'Stop Recording';
            recordBtn.style.background = '#DC2626';
        } else {
            mediaRecorder.stop();
            isRecording = false;
            recordText.textContent = 'Start Recording';
            recordBtn.style.background = '';
        }
    });
</script>
```

</body>
</html>